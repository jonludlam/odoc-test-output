<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="generator" content=
"HTML Tidy for HTML5 for Linux version 5.2.0" />
<title>Cst (ppx_expect.Expect_test_matcher.Cst)</title>
<link rel="stylesheet" href="../../../odoc.css" />
<meta charset="utf-8" />
<meta name="viewport" content=
"width=device-width,initial-scale=1.0" />
<script src="../../../highlight.pack.js">
</script>
<script>
<![CDATA[
hljs.initHighlightingOnLoad();
]]>
</script>
</head>
<body>
<div class="content">
<header>
<nav><a href="../index.html">Up</a> – <a href=
"../../index.html">ppx_expect</a> » <a href=
"../index.html">Expect_test_matcher</a> » Cst</nav>
<h1>Module <code>Expect_test_matcher.Cst</code></h1>
</header>
<aside>
<p>Concrete syntax tree of expectations and actual outputs</p>
</aside>
<aside>
<p>These types represent the contents of an <code>%expect</code>
node or of the actual output. We keep information about the
original layout so that we can give an corrected expectation that
follows the original formatting.</p>
<p>In the following names, blank means ' ' or '\t', while space
means blank or newline.</p>
</aside>
<div class="spec module" id="module-Line"><a href="#module-Line"
class="anchor"></a><code><span class="keyword">module</span>
<a href="Line/index.html">Line</a> : <span class=
"keyword">sig</span> ... <span class=
"keyword">end</span></code></div>
<dl>
<dt class="spec type" id="type-single_line"><a href=
"#type-single_line" class="anchor"></a><code><span class=
"keyword">type</span> 'a single_line</code> <code>=</code>
<code>{</code></dt>
<dd>
<table class="record">
<tr id="type-single_line.leading_blanks" class="anchored">
<td class="def field"><a href="#type-single_line.leading_blanks"
class="anchor"></a><code>leading_blanks : <a href=
"../../../base/Base/index.html#type-string">Base.string</a>;</code></td>
<td class="doc">
<p>regexp: " <code>\t</code>*"</p>
</td>
</tr>
<tr id="type-single_line.trailing_spaces" class="anchored">
<td class="def field"><a href="#type-single_line.trailing_spaces"
class="anchor"></a><code>trailing_spaces : <a href=
"../../../base/Base/index.html#type-string">Base.string</a>;</code></td>
<td class="doc">
<p>regexp: " <code>\t\n</code>*"</p>
</td>
</tr>
<tr id="type-single_line.orig" class="anchored">
<td class="def field"><a href="#type-single_line.orig" class=
"anchor"></a><code>orig : <a href=
"../../../base/Base/index.html#type-string">Base.string</a>;</code></td>
<td class="doc">
<p>regexp: "<code>^ \t\n</code>(<code>^\n</code>*<code>^
\t\n</code>)?"</p>
</td>
</tr>
<tr id="type-single_line.data" class="anchored">
<td class="def field"><a href="#type-single_line.data" class=
"anchor"></a><code>data : <span class=
"type-var">'a</span>;</code></td>
</tr>
</table>
<code>}</code></dd>
<dd>
<p>Single line represent <code>%expect</code> nodes with data on
the first line but not on the subsequent ones.</p>
<p>For instance:</p>
<pre><code class="ml">[%expect "  blah "];
[%expect {|  blah
         |}]</code></pre></dd>
</dl>
<div>
<div class="spec include">
<div class="doc">
<details open="open">
<summary><span class="def"><code><span class=
"keyword">include</span> <span class="keyword">sig</span> ...
<span class="keyword">end</span></code></span></summary>
<dl>
<dt class="spec value" id="val-sexp_of_single_line"><a href=
"#val-sexp_of_single_line" class="anchor"></a><code><span class=
"keyword">val</span> sexp_of_single_line : (<span class=
"type-var">'a</span> <span>-&gt;</span> <a href=
"../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a>)
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"index.html#type-single_line">single_line</a> <span>-&gt;</span>
<a href=
"../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt>
<dt class="spec value" id="val-compare_single_line"><a href=
"#val-compare_single_line" class="anchor"></a><code><span class=
"keyword">val</span> compare_single_line : (<span class=
"type-var">'a</span> <span>-&gt;</span> <span class=
"type-var">'a</span> <span>-&gt;</span> <a href=
"../../../base/Base/index.html#type-int">Base.int</a>)
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"index.html#type-single_line">single_line</a> <span>-&gt;</span>
<span class="type-var">'a</span> <a href=
"index.html#type-single_line">single_line</a> <span>-&gt;</span>
<a href=
"../../../base/Base/index.html#type-int">Base.int</a></code></dt>
</dl>
</details>
</div>
</div>
</div>
<dl>
<dt class="spec type" id="type-multi_lines"><a href=
"#type-multi_lines" class="anchor"></a><code><span class=
"keyword">type</span> 'a multi_lines</code> <code>=</code>
<code>{</code></dt>
<dd>
<table class="record">
<tr id="type-multi_lines.leading_spaces" class="anchored">
<td class="def field"><a href="#type-multi_lines.leading_spaces"
class="anchor"></a><code>leading_spaces : <a href=
"../../../base/Base/index.html#type-string">Base.string</a>;</code></td>
<td class="doc">
<p>regexp: "\( <code>\t</code>*\n\)*"</p>
</td>
</tr>
<tr id="type-multi_lines.trailing_spaces" class="anchored">
<td class="def field"><a href="#type-multi_lines.trailing_spaces"
class="anchor"></a><code>trailing_spaces : <a href=
"../../../base/Base/index.html#type-string">Base.string</a>;</code></td>
<td class="doc">
<p>regexp: " <code>\t</code>*" or "\(\n <code>\t</code>*\)*"</p>
</td>
</tr>
<tr id="type-multi_lines.indentation" class="anchored">
<td class="def field"><a href="#type-multi_lines.indentation"
class="anchor"></a><code>indentation : <a href=
"../../../base/Base/index.html#type-string">Base.string</a>;</code></td>
<td class="doc">
<p>regexp: " <code>\t</code>*"</p>
</td>
</tr>
<tr id="type-multi_lines.lines" class="anchored">
<td class="def field"><a href="#type-multi_lines.lines" class=
"anchor"></a><code>lines : <span class="type-var">'a</span>
<a href="Line/index.html#type-t">Line.t</a> <a href=
"../../../base/Base/index.html#type-list">Base.list</a>;</code></td>
<td class="doc">
<p>regexp: not_blank (.* not_blank)?</p>
</td>
</tr>
</table>
<code>}</code></dd>
<dd>
<p>Any <code>%expect</code> node with one or more newlines and at
least one non-blank line.</p>
<p>This also include the case with exactly one non-blank line such
as:</p>
<pre><code class="ml">[%expect {|
  blah
|}]</code></pre>
<p>This is to preserve this formatting in case the correction is
multi-line.</p>
<p><code>leading_spaces</code> contains everything until the first
non-blank line, while <code>trailing_spaces</code> is either:</p>
<ul>
<li>trailing blanks on the last line if of the form:</li>
</ul>
<pre><code class="ml">[%expect {|
           abc
           def |}]</code></pre>
<ul>
<li>all trailing spaces from the newline character (inclusive) on
the last non-blank line to the end if of the form:</li>
</ul>
<pre><code class="ml">[%expect {|
           abc
           def
|}]</code></pre></dd>
</dl>
<div>
<div class="spec include">
<div class="doc">
<details open="open">
<summary><span class="def"><code><span class=
"keyword">include</span> <span class="keyword">sig</span> ...
<span class="keyword">end</span></code></span></summary>
<dl>
<dt class="spec value" id="val-sexp_of_multi_lines"><a href=
"#val-sexp_of_multi_lines" class="anchor"></a><code><span class=
"keyword">val</span> sexp_of_multi_lines : (<span class=
"type-var">'a</span> <span>-&gt;</span> <a href=
"../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a>)
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"index.html#type-multi_lines">multi_lines</a> <span>-&gt;</span>
<a href=
"../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt>
<dt class="spec value" id="val-compare_multi_lines"><a href=
"#val-compare_multi_lines" class="anchor"></a><code><span class=
"keyword">val</span> compare_multi_lines : (<span class=
"type-var">'a</span> <span>-&gt;</span> <span class=
"type-var">'a</span> <span>-&gt;</span> <a href=
"../../../base/Base/index.html#type-int">Base.int</a>)
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"index.html#type-multi_lines">multi_lines</a> <span>-&gt;</span>
<span class="type-var">'a</span> <a href=
"index.html#type-multi_lines">multi_lines</a> <span>-&gt;</span>
<a href=
"../../../base/Base/index.html#type-int">Base.int</a></code></dt>
</dl>
</details>
</div>
</div>
</div>
<dl>
<dt class="spec type" id="type-t"><a href="#type-t" class=
"anchor"></a><code><span class="keyword">type</span> 'a t</code>
<code>=</code></dt>
<dd>
<table class="variant">
<tr id="type-t.Empty" class="anchored">
<td class="def constructor"><a href="#type-t.Empty" class=
"anchor"></a><code>|</code> <code><span class=
"constructor">Empty</span> <span class="keyword">of</span> <a href=
"../../../base/Base/index.html#type-string">Base.string</a></code></td>
<td class="doc">
<p>regexp: " <code>\t\n</code>*"</p>
</td>
</tr>
<tr id="type-t.Single_line" class="anchored">
<td class="def constructor"><a href="#type-t.Single_line" class=
"anchor"></a><code>|</code> <code><span class=
"constructor">Single_line</span> <span class="keyword">of</span>
<span class="type-var">'a</span> <a href=
"index.html#type-single_line">single_line</a></code></td>
</tr>
<tr id="type-t.Multi_lines" class="anchored">
<td class="def constructor"><a href="#type-t.Multi_lines" class=
"anchor"></a><code>|</code> <code><span class=
"constructor">Multi_lines</span> <span class="keyword">of</span>
<span class="type-var">'a</span> <a href=
"index.html#type-multi_lines">multi_lines</a></code></td>
</tr>
</table>
</dd>
</dl>
<div>
<div class="spec include">
<div class="doc">
<details open="open">
<summary><span class="def"><code><span class=
"keyword">include</span> <span class="keyword">sig</span> ...
<span class="keyword">end</span></code></span></summary>
<dl>
<dt class="spec value" id="val-sexp_of_t"><a href="#val-sexp_of_t"
class="anchor"></a><code><span class="keyword">val</span> sexp_of_t
: (<span class="type-var">'a</span> <span>-&gt;</span> <a href=
"../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a>)
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"index.html#type-t">t</a> <span>-&gt;</span> <a href=
"../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt>
<dt class="spec value" id="val-compare"><a href="#val-compare"
class="anchor"></a><code><span class="keyword">val</span> compare :
(<span class="type-var">'a</span> <span>-&gt;</span> <span class=
"type-var">'a</span> <span>-&gt;</span> <a href=
"../../../base/Base/index.html#type-int">Base.int</a>)
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"index.html#type-t">t</a> <span>-&gt;</span> <span class=
"type-var">'a</span> <a href="index.html#type-t">t</a>
<span>-&gt;</span> <a href=
"../../../base/Base/index.html#type-int">Base.int</a></code></dt>
</dl>
</details>
</div>
</div>
</div>
<dl>
<dt class="spec value" id="val-invariant"><a href="#val-invariant"
class="anchor"></a><code><span class="keyword">val</span> invariant
: (<span class="type-var">'a</span> <span>-&gt;</span> <a href=
"../../../base/Base/index.html#type-unit">Base.unit</a>)
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"index.html#type-t">t</a> <span>-&gt;</span> <a href=
"../../../base/Base/index.html#type-unit">Base.unit</a></code></dt>
<dt class="spec value" id="val-empty"><a href="#val-empty" class=
"anchor"></a><code><span class="keyword">val</span> empty :
<span class="type-var">'a</span> <a href=
"index.html#type-t">t</a></code></dt>
<dt class="spec value" id="val-map"><a href="#val-map" class=
"anchor"></a><code><span class="keyword">val</span> map :
<span class="type-var">'a</span> <a href="index.html#type-t">t</a>
<span>-&gt;</span> f:(<a href=
"../../../base/Base/index.html#type-string">Base.string</a>
<span>-&gt;</span> <span class="type-var">'a</span>
<span>-&gt;</span> <span class="type-var">'b</span>)
<span>-&gt;</span> <span class="type-var">'b</span> <a href=
"index.html#type-t">t</a></code></dt>
<dt class="spec value" id="val-data"><a href="#val-data" class=
"anchor"></a><code><span class="keyword">val</span> data :
<span class="type-var">'a</span> <a href="index.html#type-t">t</a>
<span>-&gt;</span> blank:<span class="type-var">'a</span>
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"../../../base/Base/index.html#type-list">Base.list</a></code></dt>
<dt class="spec value" id="val-strip"><a href="#val-strip" class=
"anchor"></a><code><span class="keyword">val</span> strip :
<span class="type-var">'a</span> <a href="index.html#type-t">t</a>
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"index.html#type-t">t</a></code></dt>
<dt class="spec value" id="val-to_string"><a href="#val-to_string"
class="anchor"></a><code><span class="keyword">val</span> to_string
: <span class="type-var">_</span> <a href="index.html#type-t">t</a>
<span>-&gt;</span> <a href=
"../../../base/Base/index.html#type-string">Base.string</a></code></dt>
<dt class="spec value" id="val-to_lines"><a href="#val-to_lines"
class="anchor"></a><code><span class="keyword">val</span> to_lines
: <span class="type-var">'a</span> <a href=
"index.html#type-t">t</a> <span>-&gt;</span> <span class=
"type-var">'a</span> <a href="Line/index.html#type-t">Line.t</a>
<a href=
"../../../base/Base/index.html#type-list">Base.list</a></code></dt>
<dd>
<p>For single line expectation, leading blanks and trailing spaces
are dropped.</p>
</dd>
</dl>
<dl>
<dt class="spec value" id="val-trim_lines"><a href=
"#val-trim_lines" class="anchor"></a><code><span class=
"keyword">val</span> trim_lines : <span class="type-var">'a</span>
<a href="Line/index.html#type-t">Line.t</a> <a href=
"../../../base/Base/index.html#type-list">Base.list</a>
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"Line/index.html#type-t">Line.t</a> <a href=
"../../../base/Base/index.html#type-list">Base.list</a></code></dt>
<dd>
<p>Remove blank lines at the beginning and end of the list.</p>
</dd>
</dl>
<dl>
<dt class="spec value" id="val-reconcile"><a href="#val-reconcile"
class="anchor"></a><code><span class="keyword">val</span> reconcile
: <span class="type-var">'a</span> <a href=
"index.html#type-t">t</a> <span>-&gt;</span> lines:<span class=
"type-var">'a</span> <a href="Line/index.html#type-t">Line.t</a>
<a href="../../../base/Base/index.html#type-list">Base.list</a>
<span>-&gt;</span> default_indentation:<a href=
"../../../base/Base/index.html#type-int">Base.int</a>
<span>-&gt;</span> pad_single_line:<a href=
"../../../base/Base/index.html#type-bool">Base.bool</a>
<span>-&gt;</span> <span class="type-var">'a</span> <a href=
"index.html#type-t">t</a></code></dt>
<dd>
<p>Given a contents <code>t</code> and a list of
<code>lines</code>, try to produce a new contents containing
<code>lines</code> but with the same formating as
<code>t</code>.</p>
<p><code>default_indentation</code> is the indentation to use in
case we ignore <code>t</code>'s indentation (for instance if
<code>t</code> is <code>Single_line</code> or
<code>Empty</code>).</p>
</dd>
</dl>
<dl>
<dt class="spec value" id="val-extract_indentation"><a href=
"#val-extract_indentation" class="anchor"></a><code><span class=
"keyword">val</span> extract_indentation : <span class=
"type-var">'a</span> <a href="Line/index.html#type-t">Line.t</a>
<a href="../../../base/Base/index.html#type-list">Base.list</a>
<span>-&gt;</span> <a href=
"../../../base/Base/index.html#type-string">Base.string</a> *
<span class="type-var">'a</span> <a href=
"Line/index.html#type-t">Line.t</a> <a href=
"../../../base/Base/index.html#type-list">Base.list</a></code></dt>
<dd>
<p>Compuute the longest indentation of a list of lines and trim it
from every line. It returns the found indentation and the list of
trimmed lines.</p>
</dd>
</dl>
<dl>
<dt class="spec value" id="val-stripped_original_lines"><a href=
"#val-stripped_original_lines" class=
"anchor"></a><code><span class="keyword">val</span>
stripped_original_lines : <span class="type-var">_</span> <a href=
"index.html#type-t">t</a> <span>-&gt;</span> <a href=
"../../../base/Base/index.html#type-string">Base.string</a>
<a href="../../../base/Base/index.html#type-list">Base.list</a></code></dt>
<dd>
<p>All the <code>.orig</code> fields of <code>Line.t</code> or
<code>single_line</code> values, using <code>""</code> for blank
lines.</p>
</dd>
</dl>
</div>
</body>
</html>
